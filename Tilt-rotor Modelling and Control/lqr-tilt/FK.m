
function OUT = FK(IN)

% constantes
Av =  10^2*[0,0,0,0,0,0,0,0,0.01,0,0,0,0,0,0,0;
       0,0,0,0,0,0,0,0,0,0.01,0,0,0,0,0,0;
       0,0,0,0,0,0,0,0,0,0,0.01,0,0,0,0,0;
       0,0,0,0,0,0,0,0,0,0,0,0.01,0,0,0,0;
       0,0,0,0,0,0,0,0,0,0,0,0,0.01,0,0,0;
       0,0,0,0,0,0,0,0,0,0,0,0,0,0.01,0,0;
       0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.01,0;
       0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.01;
       0,0,0,0.000000000000002,0.098100000000000,0.000000000000000,0.077204300000000,0.076840400000000,0,0,0,0,0,0,0,0;
       0,0,0,-0.098085200000000,0.000000000000348,0,0.001247230000000,-0.001253420000000,0,0,0,0,0,0,0,0;
       0,0,0,0.000000000005325,0.000000000131382,0.000000000000000,-0.003878850000000,-0.003849880000000,0,0,0,0,0,0,0,0;
       0,0,0,0.000000000129431,-0.000000000035104,-0.000000000000000,0.038877400000000,-0.038881600000000,0,0,0,0,0,0,0,0;
       0,0,0,0.000000277180000,0.000000000104729,-0.000000000000000,1.176140000000000,1.182900000000000,0,0,0,0,0,0,0,0;
       0,0,0,-0.000003175980000,-0.000000001200010,0.000000000000000,0.681144000000000,-0.682757000000000,0,0,0,0,0,0,0,0;
       0,0,0,-0.000000940774000,-0.000000182585000,0.000000000000000,-1.112230000000000,-1.237940000000000,0,0,0,0,0,0,0,0;
       0,0,0,0.000000000000000,0.000000000000000,0.000000000000000,-1.230900000000000,-1.119050000000000,0,0,0,0,0,0,0,0];

       
       
Bv =    10^4* [    0                   0                   0                   0
                   0                   0                   0                   0
                   0                   0                   0                   0
                   0                   0                   0                   0
                   0                   0                   0                   0
                   0                   0                   0                   0
                   0                   0                   0                   0
                   0                   0                   0                   0
                   0.000000030465900  -0.000000030357600  -0.000210603000000  -0.000210809000000
                   0.000019181600000  -0.000019113300000   0.000000815081000  -0.000000773896000
                   0.000050580600000   0.000049947800000   0.000029357000000   0.000029351200000
                   -0.000621247000000   0.000619037000000  -0.000002965970000   0.000003030760000
                   0.000000074630300  -0.000000074376800  -0.008945120000000  -0.008944290000000
                   0.000055469700000  -0.000055272300000   0.000226986000000  -0.000213973000000
                   0.000004764540000  -0.000004747540000   1.322840000000000   0.008891500000000
                   -0.000004897060000   0.000004879640000   0.008891500000000   1.322830000000000];



a = 10^(-5);
b = ((0.005/3)^2);

Pw = a*eye(16);
Pv = b*eye(16);
%Pw = zeros(16);
%Pv = zeros(16);

Dymed(:,1) = IN(1:16); % 16
Du(:,1) = IN(17:20); % 4
Vf_ant(:,1) = IN(21:36); %16
Pekantkant = reshape(IN(37:292),16,16); % 256

% predissão
Vp = Av*Vf_ant+ Bv*Du;
Dy = Vp;

% fusão de dados
Pekkant = Av*Pekantkant*(Av')+Pw; % propagação de covariancia
%Pekkant = (Pekkant + Pekkant')/2;
Nk = Pekkant/(Pekkant+Pv); % atualização do ganho
Vf = Vp + Nk*(Dymed - Dy); %fusão
Pekk = (eye(16)-Nk)*Pekkant*(eye(16)-Nk)' + Nk*Pv*(Nk');

OUT = [Vf;reshape(Pekk,256,1)]; % vf - elementos correspondetes a pertubação

